<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Application - Mazer Admin Dashboard</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    
    <link rel="stylesheet" href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon">

    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" integrity="sha384-W8fXfP3gkOKtndU4JGtKDvXbO53Wy8SZCQHczT5FMiiqmQfUpWbYdTil/SxwZgAN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js" integrity="sha384-skAcpIdS7UcVUC05LJ9Dxay8AXcDYfBJqt1CJ85S/CFujBsIzCIv+l9liuYLaMQ/" crossorigin="anonymous"></script> -->
    


    <link rel="stylesheet" href="assets/css/pages/email.css">

    <link rel="stylesheet" href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon">

    <script src="assets/vendors/choices.js/choices.min.js"></script>
    <script src="assets/js/pages/form-element-select.js"></script>

    

</head>

<body>
   
    <div id="app">
        <div id="sidebar" class="active">
            <div class="sidebar-wrapper active">
                <div class="sidebar-header">
                    <div class="d-flex justify-content-between">
                        <a href="perfil_usuario.html"><img src="assets/images/logo/USAC_Logo_University_of_San_Carlos_of_Guatemala.jpg" alt="Logo" srcset=""></a>
                        <div class="toggler">
                            <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
                        </div>
                    </div>
                </div>
                <div class="sidebar-menu">
                    <ul class="menu">
                        <li class="sidebar-title">Menu</li>

                        <li class="sidebar-item  ">
                            <a href="post-application.html" class='sidebar-link'>
                                <i class="bi bi-chat-square-quote"></i>
                                <span>Publicaciones</span>
                            </a>
                        </li>

                        <li class="sidebar-item  ">
                            <a href="perfil_usuario.html" class='sidebar-link'>
                                <i class="bi bi-person-lines-fill"></i>
                                <span>Mi Perfil</span>
                            </a>
                        </li>

                    </ul>
                </div>
                <button class="sidebar-toggler btn x"><i data-feather="x"></i></button>
            </div>
        </div>
        
        <div id="main"   class='layout-navbar' >
            
            <header class="mb-3">
                <nav class="navbar navbar-expand navbar-light ">
                    <div class="container-fluid">
                        <a href="#" class="burger-btn d-block">
                            <i class="bi bi-justify fs-3"></i>
                        </a>

                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                                <li class="nav-item dropdown me-1">
                                    <a class="nav-link active dropdown-toggle" href="#" data-bs-toggle="dropdown"
                                        aria-expanded="false">
                                        <i class='bi bi-envelope bi-sub fs-4 text-gray-600'></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                                        <li>
                                            <h6 class="dropdown-header" >Mail</h6>
                                        </li>
                                        <li><a class="dropdown-item"href="post-application.html">Ver Publicaciones</a></li>
                                    </ul>
                                </li>
                                <li class="nav-item dropdown me-3">
                                    <a class="nav-link active dropdown-toggle" href="#" data-bs-toggle="dropdown"
                                        aria-expanded="false">
                                        <i class='bi bi-bell bi-sub fs-4 text-gray-600'></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                                        <li>
                                            <h6 class="dropdown-header">Notifications</h6>
                                        </li>
                                        <li><a class="dropdown-item">No notification available</a></li>
                                    </ul>
                                </li>
                            </ul>
                            <div class="dropdown">
                                <a href="#" data-bs-toggle="dropdown" aria-expanded="false">
                                    <div class="user-menu d-flex">
                                        <div class="user-name text-end me-3">
                                            <h6 class="mb-0 text-gray-600">Bienvenido</h6>
                                            <p class="mb-0 text-sm text-gray-600">Alumno</p>
                                        </div>
                                        <div class="user-img d-flex align-items-center">
                                            <div class="avatar avatar-md">
                                                <img src="assets/images/faces/1.jpg">
                                            </div>
                                        </div>
                                    </div>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">

                                    <li><a class="dropdown-item" href="perfil_usuario.html"><i
                                        class="icon-mid bi bi-person-lines-fill me-2"></i> Mi Perfil</a></li>
                                   
                                    <li onClick="test()"><a class="dropdown-item" href="auth-login.html"><i
                                        class="icon-mid bi bi-box-arrow-left me-2"></i> Logout</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </nav>
            </header>
            
            <div class="page-heading email-application">
                <div class="page-title">
                    <div class="row">
                        <div class="col-12 col-md-6 order-md-1 order-last">
                            <h3>Publicaciones</h3>
                            <p class="text-subtitle text-muted">Publica tus expreriencias sobre tus cursos o catedraticos con los que has recibido clase.</p>
                        </div>
                        <div class="col-12 col-md-6 order-md-2 order-first">
                            <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">

                                <!-- Barra de Busqueda -->
                                <script src="assets/js/search.js"></script>
                                <ol class="breadcrumb">
                                    <div class="form-group position-relative has-icon-left" style="padding-right:40px">
                                        <input class="form-control border-end-0 border rounded-pill" type="text" value=""  placeholder="Ingrese el numero de Carnet" id="barraBusqueda" style="width: 110%; box-shadow: 0 2px 4px 0 rgba(90,141,238,.6);">
                                        <div class="form-control-icon">
                                            <i class="bi bi-search" style="color: rgb(0, 0, 0); padding-right:10px"></i>
                                        </div>
                                        
                                    </div>
                                    <button class="btn btn-primary" style= "height: 40px; box-shadow: 0 2px 4px 0 rgba(90,141,238,.6);" onClick="buscarUsuario()">Buscar</button>
                                </ol>

                                <!-- Barra de Busqueda -->
                                
                        
                            </nav>
                        </div>
                    </div>
                </div>
                <section class="section content-area-wrapper">
                    <div class="sidebar-left">
                        <div class="sidebar">
                            <div class="sidebar-content email-app-sidebar d-flex">
                                <!-- sidebar close icon -->
                                <span class="sidebar-close-icon">
                                    <i class="bx bx-x"></i>
                                </span>
                                <!-- sidebar close icon -->
                                <div class="email-app-menu">
                                    <div class="form-group form-group-compose">
                                        <!-- compose button  -->
                                        <button type="button" class="btn btn-primary btn-block my-4 compose-btn" data-toggle="modal" data-target="#exampleModal" onClick="setNombre()">
                                            <i class="bx bx-plus"></i>
                                            Escribir Publicacion
                                        </button>
                                        <div class="modal fade bd-example-modal-lg" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="false">
                                            <div class="modal-dialog modal-lg" role="document">
                                              <div class="modal-content">
                                                <div class="modal-header">
                                                  <h5 class="modal-title" id="exampleModalLabel">Escribir nueva publicacion</h5>
                                                  
                                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                  </button>
                                                </div>
                                                <div class="card-body pt-0">
                                                    <div class="form-group pb-50" id="emailfrom">
                                                        
                                                    </div>
                                                    <div class="form-label-group">
                                                        <label>Publicacion Sobre:</label>
                                                        <div class="form-check">
                                                            
                                                            <label class="form-check-label" for="flexRadioDefault1">
                                                                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1" value = "2" onclick="cambiarSeleccion(this.value)">
                                                                Ingeniero
                                                            </label>
                                                          </div>
                                                          <div class="form-check">
                                                            
                                                            <label class="form-check-label" for="flexRadioDefault2">
                                                                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" value = "1" onclick="cambiarSeleccion(this.value)">
                                                                Curso
                                                            </label>
                                                          </div>
                                                        
                                                    </div>
                                                    <div class="form-group" id="Seleccionar">
                                                    </div>

                                                    <div class="form-label-group">
                                                        <label for="titulo">Titulo de la Publicacion</label>
                                                        <input type="text" id="titulo" class="form-control"
                                                            placeholder="Titulo">
                                                        
                                                    </div>
                                                    <div class="form-label-group">
                                                        <label for="contenido">Contenido de la Publicacion</label>
                                                        <textarea class="form-control" id="contenido" rows="3" placeholder="Contenido"></textarea>
                                                    </div>
                                                    
                                                </div>
                                                <div class="modal-footer">
                                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                  <button type="button" class="btn btn-primary" onClick="publicar()">Publicar</button>
                                                </div>
                                              </div>
                                            </div>
                                          </div>

                                    </div>
                                    <div class="sidebar-menu-list ps" style="margin-top: -30px;">
                                        <!-- sidebar label start -->
                                        
                                        <label class="sidebar-label">Buscar por Catedratico/Curso</label>
                                        <div class="input-group">
                                            <input type="search" class="form-control rounded" placeholder="Buscar" aria-label="Search" aria-describedby="search-addon" id ="busquedaPost">
                                            <button type="button" class="btn btn-outline-primary" onclick="getPostBusqueda()"><i class="bi bi-search"></i></button>
                                        </div>
                                        

                                        <label class="sidebar-label">Filtrar</label>
                                        <div class="list-group list-group-labels" >
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="2" id="filtroProf" checked onclick="getPostFiltro()">
                                                <label class="form-check-label" for="flexCheckDefault">
                                                  Catedraticos
                                                </label>
                                              </div>
                                              <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="1" id="filtroCurso" checked onclick="getPostFiltro()">
                                                <label class="form-check-label" for="flexCheckChecked">
                                                  Cursos
                                                </label>
                                              </div>
                                        </div>
                                        <!-- sidebar label end -->
                                        <div class="ps__rail-x" style="left: 0px; bottom: 0px;">
                                            <div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div>
                                        </div>
                                        <div class="ps__rail-y" style="top: 0px; right: 0px;">
                                            <div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 0px;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- User new mail right area -->
                            
                            <!--/ User Chat profile right area -->
                        </div>
                    </div>
                    <div class="content-right">
                        <div class="content-overlay"></div>
                        <div class="content-wrapper">
                            <div class="content-header row">
                            </div>
                            <div class="content-body">
                                <!-- email app overlay -->
                                <div class="app-content-overlay"></div>
                                <div class="email-app-area">
                                    <!-- Email list Area -->
                                    <div class="email-app-list-wrapper">
                                        <div class="email-app-list">
                                            <div class="email-action">
                                                <!-- action left start here -->
                                            
                                                <!-- action left end here -->

                                                <!-- action right start here -->
                                                <div
                                                    class="action-right d-flex flex-grow-1 align-items-center justify-content-around">
                                                    <!-- search bar  -->
                                                    <div class="email-fixed-search flex-grow-1">
                                                        <div class="sidebar-toggle d-block d-lg-none">
                                                            <i class="bx bx-menu"></i>
                                                        </div>

                                                        <div class="form-group position-relative  mb-0 has-icon-left">
                                                            <label style="font-size: 1.5rem;">Publicaciones Recientes</label>
                                                            
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- / action right -->

                                            <!-- email user list start -->
                                            <div class="email-user-list list-group ps--active-y" style="overflow: auto; max-width: 1240px;">
                                                <ul class="users-list-wrapper media-list" id="areaCorreos">
                                                </ul>
                                                <!-- email user list end -->

                                                <div class="modal fade bd-example-modal-lg" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" >
                                                    <div class="modal-dialog modal-lg" role="document">
                                                      <div class="modal-content"id="ModalPost">
                                
                                                      </div>
                                                    </div>
                                                  </div>

                                                <!-- no result when nothing to show on list -->
                                                <div class="no-results">
                                                    <i class="bx bx-error-circle font-large-2"></i>
                                                    <h5>No Items Found</h5>
                                                </div>
                                                <div class="ps__rail-x" style="left: 0px; bottom: 0px;">
                                                    <div class="ps__thumb-x" tabindex="0"
                                                        style="left: 0px; width: 0px;"></div>
                                                </div>
                                                <div class="ps__rail-y" style="top: 0px; height: 733px; right: 0px;">
                                                    <div class="ps__thumb-y" tabindex="0"
                                                        style="top: 0px; height: 567px;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--/ Email list Area -->

                                    <!-- Detailed Email View -->
                                    
                                    <!--/ Detailed Email View -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            
        </div>
    </div>
    <script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    
    <script src="assets/js/main.js"></script>
    
    <script>
        function cambiarSeleccion(valor) {
            var selectForm = document.querySelector('#Seleccionar');
            cadena = ""
            var tipo = valor

            if (tipo == 2){
               
                fetch('http://192.168.0.13:3000/catedraticos',{
                    method: 'GET',
                    })
                    .then(res => res.json())
                    .catch(err =>{
                        console.log("Ha ocurrido un error");
                        alert("Ha ocurrido un error al leer los datos")
                    })
                    .then(response =>{
                        console.log(response)

                        cadena+=`
                            <label>Catedratico</label><br>
                            <select class="selectpicker" data-live-search="true" data-live-search-style="startsWith" id="selectCatedratico"> 
                        `

                        for(var i in response){
                            cadena += `
                            <option value="${(response[i].Nombre)}">${response[i].Nombre}</option>
                            `
                        }
                        cadena += "</select>"
                        selectForm.innerHTML = cadena;
                        localStorage.setItem("tipo", "catedratico")
                    })

            

            }
            else if(tipo == 1){
                fetch('http://192.168.0.13:3000/cursos',{
                    method: 'GET',
                    })
                    .then(res => res.json())
                    .catch(err =>{
                        console.log("Ha ocurrido un error");
                        alert("Ha ocurrido un error al leer los datos")
                    })
                    .then(response =>{
                        console.log(response)

                        cadena+=`
                            <label>Cursos</label><br>
                            <select class="selectpicker" data-live-search="true" data-live-search-style="startsWith" id="selectCurso">

                        `

                        for(var i in response){
                            cadena += `
                            <option value="${(response[i].Nombre)}">${response[i].Nombre}</option>
                            `
                        }
                        cadena += "</select>"
                        selectForm.innerHTML = cadena;
                        localStorage.setItem("tipo", "curso")
                    })

                }  

            
        }

        function publicar(){
            var titulo = document.querySelector('#titulo').value
            var contenido = document.querySelector('#contenido').value
            var tipo = localStorage.getItem("tipo")
            var nombreUsuario = sessionStorage.getItem("NombreUsuario")
            var carnetUsuario = sessionStorage.getItem("Usuario")

            if(tipo == "curso"){
                var curso = document.querySelector('#selectCurso').value

                objeto ={
                    'nombre':nombreUsuario,
                    'carnet':carnetUsuario,
                    'titulo':titulo,
                    'contenido':contenido,
                    'tipo':tipo,
                    'curso':curso
                }
                console.log(objeto)

                fetch('http://192.168.0.13:3000/publicacion',{
                    method: 'POST',
                    body: JSON.stringify(objeto),
                    headers:{
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': '*',}})
                    .then(res => res.json())
                    .catch(err =>{
                        console.log("Ha ocurrido un error");
                        alert("Ha ocurrido un error")
                    })
                    .then(response =>{
                        if(response.Mensaje == "Creado"){
                            alert("Se ha realizado la publicacion");
                            location.reload(); 
                        }else if(response.Mensaje != "Creado"){
                            console.log(response.Mensaje)
                        }     
                    })
            }
            else if(tipo == "catedratico"){
                var catedratico = document.querySelector('#selectCatedratico').value

                objeto ={
                    'nombre':nombreUsuario,
                    'carnet':carnetUsuario,
                    'titulo':titulo,
                    'contenido':contenido,
                    'tipo':tipo,
                    'catedratico':catedratico
                }
                console.log(objeto)

                fetch('http://192.168.0.13:3000/publicacion',{
                    method: 'POST',
                    body: JSON.stringify(objeto),
                    headers:{
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': '*',}})
                    .then(res => res.json())
                    .catch(err =>{
                        console.log("Ha ocurrido un error");
                        alert("Ha ocurrido un error")
                    })
                    .then(response =>{
                        if(response.Mensaje == "Creado"){
                            alert("Se ha realizado la publicacion");
                            location.reload(); 
                        }else if(response.Mensaje != "Creado"){
                            console.log(response.Mensaje)
                        }     
                    })
            }

        }

        function getPosts(){
            cadena = ""
            var areaCorreos = document.querySelector('#areaCorreos')
            var currentdate = new Date();

            fetch('http://192.168.0.13:3000/publicacion',{
                method: 'GET',
                })
                .then(res => res.json())
                .catch(err =>{
                    console.log("Ha ocurrido un error");
                    alert("Ha ocurrido un error al leer los datos")
                })
                .then(response =>{
                    console.log(response)

                    for(var i in response){
                        var num = Math.floor(Math.random() * 8)+1;
                        cadena += `
                        <li class="media mail-read" id="${(response[i].PostID)}"  onclick="checkPost(this.id)" data-toggle="modal" data-target="#exampleModal2">
                    
                            <div class="pr-50">
                                <div class="avatar">
                                    <img class="rounded-circle"
                                        src="assets/images/faces/${(num)}.jpg"
                                        alt="Generic placeholder image">
                                </div>
                            </div>
                            <div class="media-body">
                                <div class="user-details">
                                    <div class="mail-items">
                                        <span
                                            class="list-group-item-text text-truncate"><b>${(response[i].NombreUsuario)}: </b>${(response[i].Titulo)}</span>
                                    </div>
                                </div>
                                <div class="mail-message">
                                    <p class="list-group-item-text mb-0 truncate">
                                        ${(response[i].Contenido)}
                                    </p>
                                    <div class="mail-meta-item">
                                        <span class="float-right">
                                            <span
                                                class="bullet bullet-danger bullet-sm"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </li>
                        `
                    }
                    areaCorreos.innerHTML = cadena;
                })
        }

        function checkPost(id){
            var areaPost = document.querySelector('#ModalPost')
            var cadena = ""

            fetch('http://192.168.0.13:3000/publicacion/'+id,{
                method: 'GET',
                })
                .then(res => res.json())
                .catch(err =>{
                    console.log("Ha ocurrido un error");
                    alert("Ha ocurrido un error al leer los datos")
                })
                .then(response =>{
                    console.log(response) 
                    if (response.Mensaje == "Done"){
                        cadena +=`
                            <div class="modal-header" >
                                <h5 class="modal-title" id="exampleModalLabel">Post: ${(response.Titulo)}</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group pb-50">
                                    <label for="emailfrom">Autor:</label>
                                    <input type="text" id="emailfrom" class="form-control"
                                        placeholder="${(response.NombreUsuario)}" disabled="">
                                </div>`

                                if(response.NombreCurso != null){
                                    cadena +=`
                                        <div class="form-group pb-50">
                                            <label for="emailfrom">Curso</label>
                                            <input type="text" id="emailfrom" class="form-control"
                                                placeholder="${(response.NombreCurso)}" disabled="">
                                        </div>
                                        
                                        <div class="form-group pb-50">
                                            <label>Contenido de la Publicacion</label>
                                            <textarea class="form-control" id="contenido" rows="3" placeholder="${(response.Contenido)}" disabled=""></textarea>
                                        </div>
        
                                        <div class="form-group pb-50">
                                            <label>Comentarios</label>
                                            <div class="message-form d-flex flex-direction-column align-items-center">
                                                <div class="d-flex flex-grow-1 ml-4">
                                                    <input type="text" class="form-control" placeholder="Añade un comentario..." style="margin-right: 5px;" id="comentarioNuevo">
                                                    <button type="button" class="btn btn-primary" onClick="postComment(${(response.PostID)})">Publicar</button>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="email-user-list list-group ps--active-y" style="overflow: auto; height: 20%;">
                                            <ul class="users-list-wrapper media-list" id="areaComentarios">
        
                                                <li class="media mail-read">
                                                    <div class="pr-50">
                                                        <div class="avatar">
                                                            <img class="rounded-circle"
                                                                src="assets/images/faces/3.jpg"
                                                                alt="Generic placeholder image">
                                                        </div>
                                                    </div>
                                                    <div class="media-body">
                                                        <div class="user-details">
                                                            <div class="mail-items">
                                                                <span
                                                                    class="list-group-item-text text-truncate">Nombre</span>
                                                            </div>
                                                        </div>
                                                        <div class="mail-message">
                                                            <p class="list-group-item-text mb-0 truncate">
                                                                Comentario
                                                            </p>
                                                            <div class="mail-meta-item">
                                                                <span class="float-right">
                                                                    <span
                                                                        class="bullet bullet-danger bullet-sm"></span>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                                
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    </div>                  
                                    `
                                }

                                if(response.NombreCatedratico != null){
                                    cadena +=`
                                        <div class="form-group pb-50">
                                            <label for="emailfrom">Catedratico</label>
                                            <input type="text" id="emailfrom" class="form-control"
                                                placeholder="${(response.NombreCatedratico)}" disabled="">
                                        </div>
                                        <div class="form-group pb-50">
                                            <label>Contenido de la Publicacion</label>
                                            <textarea class="form-control" id="contenido" rows="3" placeholder="${(response.Contenido)}" disabled=""></textarea>
                                        </div>
        
                                        <div class="form-group pb-50">
                                            <label>Comentarios</label>
                                            <div class="message-form d-flex flex-direction-column align-items-center">
                                                <div class="d-flex flex-grow-1 ml-4">
                                                    <input type="text" class="form-control" placeholder="Añade un comentario..." style="margin-right: 5px;" id="comentarioNuevo">
                                                    <button type="button" class="btn btn-primary" onClick="postComment(${(response.PostID)})">Publicar</button>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="email-user-list list-group ps--active-y" style="overflow: auto; height: 20%;">
                                            <ul class="users-list-wrapper media-list" id="areaComentarios">
        
                                                <li class="media mail-read">
                                                    <div class="pr-50">
                                                        <div class="avatar">
                                                            <img class="rounded-circle"
                                                                src="assets/images/faces/3.jpg"
                                                                alt="Generic placeholder image">
                                                        </div>
                                                    </div>
                                                    <div class="media-body">
                                                        <div class="user-details">
                                                            <div class="mail-items">
                                                                <span
                                                                    class="list-group-item-text text-truncate">Nombre</span>
                                                            </div>
                                                        </div>
                                                        <div class="mail-message">
                                                            <p class="list-group-item-text mb-0 truncate">
                                                                Comentario
                                                            </p>
                                                            <div class="mail-meta-item">
                                                                <span class="float-right">
                                                                    <span
                                                                        class="bullet bullet-danger bullet-sm"></span>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                                
                                            </ul>
                                        </div>
   
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    </div>
                                    `
                                    
                                    
                                }
                                
                               
                        areaPost.innerHTML = cadena
                        getComments(id)
                    }
                   
                })     
                
                //getComments(id)
            
        }

        function getComments(id){
            var listaComentarios = document.querySelector('#areaComentarios')
            cadena = ""

            fetch('http://192.168.0.13:3000/comentario/'+id,{
                method: 'GET'
                })
                .then(res => res.json())
                .catch(err =>{
                    console.log("Ha ocurrido un error");
                    alert("Ha ocurrido un error")
                })
                .then(response =>{
                    console.log(response)
                    for(var i in response){
                        console.log(i)
                        var num = Math.floor(Math.random() * 8)+1;
                        cadena +=`
                        <li class="media mail-read">
                            <div class="pr-50">
                                <div class="avatar">
                                    <img class="rounded-circle"
                                        src="assets/images/faces/${(num)}.jpg"
                                        alt="Generic placeholder image">
                                </div>
                            </div>
                            <div class="media-body">
                                <div class="user-details">
                                    <div class="mail-items">
                                        <span
                                            class="list-group-item-text text-truncate">${(response[i].NombreUsuario)}</span>
                                    </div>
                                </div>
                                <div class="mail-message">
                                    <p class="list-group-item-text mb-0 truncate">
                                        ${(response[i].Contenido)}
                                    </p>
                                    <div class="mail-meta-item">
                                        <span class="float-right">
                                            <span
                                                class="bullet bullet-danger bullet-sm"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </li>
                        
                        `
                    }
                    listaComentarios.innerHTML = cadena
                })
        

        }

        function postComment(id){
            console.log("here")
            var listaComentarios = document.querySelector('#areaComentarios')
            cadena = ""

            var contenido = document.querySelector('#comentarioNuevo').value
            var postId = id

            var nombreUsuario = sessionStorage.getItem("NombreUsuario")
            var carnetUsuario = sessionStorage.getItem("Usuario")

            objeto ={
                'nombreUsuario':nombreUsuario,
                'contenido':contenido,
                'postId':postId
            }


            fetch('http://192.168.0.13:3000/comentario',{
                method: 'POST',
                body: JSON.stringify(objeto),
                headers:{
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*',}})
                .then(res => res.json())
                .catch(err =>{
                    console.log("Ha ocurrido un error");
                    alert("Ha ocurrido un error")
                })
                .then(response =>{
                    getComments(id)
                })
        }

        function getPostFiltro(){
            var areaCorreos = document.querySelector('#areaCorreos')
            var currentdate = new Date();
            areaCorreos.innerHTML = null
            filtro = "3"
            noFiltro = false
            var cadena = ""

            if ($('#filtroProf').is(':checked') && !$('#filtroCurso').is(':checked')){
                filtro = "2"
            }

            if (!$('#filtroProf').is(':checked') && $('#filtroCurso').is(':checked')){
                filtro = "1"
            }
            if (!$('#filtroProf').is(':checked') && !$('#filtroCurso').is(':checked')){
                noFiltro = true
            }
            if ($('#filtroProf').is(':checked') && $('#filtroCurso').is(':checked')){
                filtro = "3"
            }

            if (noFiltro == false){
                fetch('http://192.168.0.13:3000/publicacion/filtro/'+filtro,{
                    method: 'GET',
                    })
                    .then(res => res.json())
                    .catch(err =>{
                        console.log("Ha ocurrido un error");
                        alert("Ha ocurrido un error al leer los datos")
                    })
                    .then(response =>{
                        console.log(response)
    
                        for(var i in response){
                            var num = Math.floor(Math.random() * 8)+1;
                            cadena += `
                            <li class="media mail-read" id="${(response[i].PostID)}"  onclick="checkPost(this.id)" data-toggle="modal" data-target="#exampleModal2">
                        
                                <div class="pr-50">
                                    <div class="avatar">
                                        <img class="rounded-circle"
                                            src="assets/images/faces/${(num)}.jpg"
                                            alt="Generic placeholder image">
                                    </div>
                                </div>
                                <div class="media-body">
                                    <div class="user-details">
                                        <div class="mail-items">
                                            <span
                                                class="list-group-item-text text-truncate"><b>${(response[i].NombreUsuario)}: </b>${(response[i].Titulo)}</span>
                                        </div>
                                    </div>
                                    <div class="mail-message">
                                        <p class="list-group-item-text mb-0 truncate">
                                            ${(response[i].Contenido)}
                                        </p>
                                        <div class="mail-meta-item">
                                            <span class="float-right">
                                                <span
                                                    class="bullet bullet-danger bullet-sm"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            `
                        }
                        areaCorreos.innerHTML = cadena;
                    })
            }

        }

        function getPostBusqueda(){
            var areaCorreos = document.querySelector('#areaCorreos')
            var cadenaBusqueda = document.querySelector('#busquedaPost').value
            areaCorreos.innerHTML = null
            var cadena = ""

            if (cadenaBusqueda == ""){
                getPosts()
            }
            else{
                fetch('http://192.168.0.13:3000/publicacion/buscar/'+ cadenaBusqueda,{
                    method: 'GET',
                    })
                    .then(res => res.json())
                    .catch(err =>{
                        console.log("Ha ocurrido un error");
                        alert("Ha ocurrido un error al leer los datos")
                    })
                    .then(response =>{
                        console.log(response)
        
                        for(var i in response){
                            var num = Math.floor(Math.random() * 8)+1;
                            cadena += `
                                <li class="media mail-read" id="${(response[i].PostID)}"  onclick="checkPost(this.id)" data-toggle="modal" data-target="#exampleModal2">
                            
                                    <div class="pr-50">
                                        <div class="avatar">
                                            <img class="rounded-circle"
                                                src="assets/images/faces/${(num)}.jpg"
                                                alt="Generic placeholder image">
                                        </div>
                                    </div>
                                    <div class="media-body">
                                        <div class="user-details">
                                            <div class="mail-items">
                                                <span
                                                    class="list-group-item-text text-truncate"><b>${(response[i].NombreUsuario)}: </b>${(response[i].Titulo)}</span>
                                            </div>
                                        </div>
                                        <div class="mail-message">
                                            <p class="list-group-item-text mb-0 truncate">
                                                ${(response[i].Contenido)}
                                            </p>
                                            <div class="mail-meta-item">
                                                <span class="float-right">
                                                    <span
                                                        class="bullet bullet-danger bullet-sm"></span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                `
                        }
                        areaCorreos.innerHTML = cadena;
                    })
            }
        }


        function redireccionar(){

        }

        function test(){
            location.href = "auth-login.html"
            sessionStorage.removeItem("Usuario")
        }
       
        var usuarioPublicacion = document.querySelector('#emailfrom')
        var texto = 
        `
        <label for="emailfrom">De:</label>
        <input type="text"  class="form-control"
        placeholder="${(sessionStorage.getItem("NombreUsuario"))}" disabled="">
        `
        usuarioPublicacion.innerHTML=texto

        //window.onload = cambiarSeleccion(1)
        window.onload = getPosts()

    </script>

    <script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"></script>

</body>

</html>